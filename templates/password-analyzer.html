<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Lab - AI CyberShield</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- GLOBAL THEME --- */
        :root {
            --bg-dark: #121212;
            --card-bg: #1e1e1e;
            --accent: #00e5ff; /* Cyber Blue */
            --accent-dim: #0099aa;
            --danger: #ff4444;
            --warning: #ffbb33;
            --success: #00c851;
            --text-main: #e0e0e0;
            --border: #333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .navbar {
            padding: 1rem 5%;
            background-color: var(--card-bg);
            border-bottom: 2px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { font-size: 1.5rem; font-weight: 700; color: #fff; text-decoration: none; }
        .back-btn { color: #888; text-decoration: none; transition: 0.3s; }
        .back-btn:hover { color: var(--accent); }

        .container {
            max-width: 1200px;
            margin: 3rem auto;
            padding: 0 1rem;
            flex-grow: 1;
        }

        .header-section { text-align: center; margin-bottom: 3rem; }
        .header-section h1 { font-size: 2.5rem; color: #fff; margin-bottom: 0.5rem; }
        .header-section span { color: var(--accent); }

        /* --- DUAL PANEL LAYOUT --- */
        .lab-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .tool-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
        }

        .card-title {
            font-size: 1.2rem;
            color: var(--accent);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* --- ANALYZER STYLES --- */
        .password-input {
            width: 100%;
            padding: 15px;
            background: #121212;
            border: 1px solid #444;
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            outline: none;
            transition: 0.3s;
        }
        .password-input:focus { border-color: var(--accent); box-shadow: 0 0 10px rgba(0, 229, 255, 0.2); }

        .analyze-btn {
            padding: 12px;
            background: var(--accent);
            color: #000;
            font-weight: 700;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.3s;
        }
        .analyze-btn:hover { background: #fff; }

        .result-box {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #000;
            border-radius: 6px;
            border-left: 4px solid #444;
            display: none;
        }
        .strength-badge { padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 0.9rem; }
        .st-Weak { background: rgba(255, 68, 68, 0.2); color: var(--danger); }
        .st-Medium { background: rgba(255, 187, 51, 0.2); color: var(--warning); }
        .st-Strong { background: rgba(0, 200, 81, 0.2); color: var(--success); }

        /* --- GENERATOR STYLES --- */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 6px;
            transition: 0.2s;
        }
        .checkbox-wrapper:hover { background: rgba(255,255,255,0.1); }
        
        input[type="checkbox"] { accent-color: var(--accent); width: 18px; height: 18px; }

        .length-control {
            grid-column: span 2;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        input[type="range"] { width: 100%; accent-color: var(--accent); }

        .generated-display {
            background: #121212;
            border: 1px solid var(--accent);
            color: #fff;
            padding: 15px;
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 1rem;
            cursor: pointer;
            position: relative;
            word-break: break-all;
        }
        
        .generated-display:hover { background: #1a1a1a; }
        
        .copy-tooltip {
            position: absolute;
            top: -10px; right: -10px;
            background: var(--accent);
            color: #000;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            display: none;
        }

        .generate-btn {
            width: 100%;
            padding: 15px;
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
            font-weight: 700;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.3s;
        }
        .generate-btn:hover { background: var(--accent); color: #000; }

        @media (max-width: 768px) {
            .lab-grid { grid-template-columns: 1fr; }
        }
        
        footer { text-align: center; padding: 2rem; color: #666; border-top: 1px solid #222; margin-top: auto; }
    </style>
</head>
<body>

    <nav class="navbar">
        <a href="/dashboard" class="logo">AI CyberShield</a>
        <a href="/dashboard" class="back-btn"><i class="fas fa-arrow-left"></i> Dashboard</a>
    </nav>

    <div class="container">
        <div class="header-section">
            <h1>Password <span style="color:var(--accent)">Lab</span></h1>
            <p>Analyze vulnerability and generate cryptographically secure credentials.</p>
        </div>

        <div class="lab-grid">
            
            <div class="tool-card">
                <h3 class="card-title"><i class="fas fa-search"></i> Strength Analyzer</h3>
                
                <label style="color:#888; margin-bottom:5px; font-size:0.9rem;">ENTER PASSWORD TO TEST:</label>
                <input type="text" id="passwordInput" class="password-input" placeholder="Type password...">
                
                <button class="analyze-btn" onclick="checkStrength()">Check Security</button>

                <div id="resultBox" class="result-box">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <span style="color:#888">Risk Level:</span>
                        <span id="strengthBadge" class="strength-badge">Analyzing...</span>
                    </div>
                    <p id="mainFinding" style="color:white; font-size:0.95rem;"></p>
                    <div id="checksList" style="margin-top:10px; font-size:0.85rem; color:#aaa;"></div>
                </div>
            </div>

            <div class="tool-card">
                <h3 class="card-title"><i class="fas fa-key"></i> Secure Generator</h3>

                <div class="generated-display" onclick="copyToClipboard()" id="generatedOutput">
                    <span style="color:#555">CLICK GENERATE</span>
                    <span id="copyMsg" class="copy-tooltip">COPIED!</span>
                </div>

                <div class="options-grid">
                    <div class="length-control">
                        <div style="display:flex; justify-content:space-between; color:#fff;">
                            <label>Length</label>
                            <span id="lengthVal">16</span>
                        </div>
                        <input type="range" id="lenRange" min="8" max="64" value="16" oninput="document.getElementById('lengthVal').innerText = this.value">
                    </div>

                    <label class="checkbox-wrapper">
                        <input type="checkbox" id="chkUpper" checked> 
                        <span>Uppercase (A-Z)</span>
                    </label>
                    <label class="checkbox-wrapper">
                        <input type="checkbox" id="chkLower" checked> 
                        <span>Lowercase (a-z)</span>
                    </label>
                    <label class="checkbox-wrapper">
                        <input type="checkbox" id="chkNumbers" checked> 
                        <span>Numbers (0-9)</span>
                    </label>
                    <label class="checkbox-wrapper">
                        <input type="checkbox" id="chkSymbols" checked> 
                        <span>Symbols (@#$%)</span>
                    </label>
                </div>

                <button class="generate-btn" onclick="generatePassword()">Generate Password</button>
            </div>

        </div>
    </div>

    <footer>&copy; 2025 AI CyberShield Matrix</footer>

    <script>
        // --- 1. ANALYZER LOGIC (Backend) ---
        async function checkStrength() {
            const pwd = document.getElementById('passwordInput').value;
            const resBox = document.getElementById('resultBox');
            const badge = document.getElementById('strengthBadge');
            const finding = document.getElementById('mainFinding');
            const checks = document.getElementById('checksList');

            if(!pwd) return;

            resBox.style.display = 'block';
            resBox.style.borderLeftColor = '#444';
            badge.innerText = "Processing...";
            badge.className = "strength-badge";

            try {
                const response = await fetch('/api/password-analyzer', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ input: pwd, mode: 'analyze' })
                });

                const data = await response.json();

                if(data.ok) {
                    const level = data.risk_level;
                    badge.innerText = level;
                    
                    // Style badge
                    if(level.includes("Very Strong") || level.includes("Strong")) {
                        badge.className = "strength-badge st-Strong";
                        resBox.style.borderLeftColor = "var(--success)";
                    } else if (level.includes("Medium")) {
                        badge.className = "strength-badge st-Medium";
                        resBox.style.borderLeftColor = "var(--warning)";
                    } else {
                        badge.className = "strength-badge st-Weak";
                        resBox.style.borderLeftColor = "var(--danger)";
                    }

                    finding.innerText = data.main_finding;

                    // Show detailed checks
                    if(data.advanced_report_details && data.advanced_report_details.features_analyzed) {
                        const feats = data.advanced_report_details.features_analyzed;
                        let html = "";
                        for (const [key, val] of Object.entries(feats)) {
                            const icon = val === 'PASS' ? '<i class="fas fa-check" style="color:var(--success)"></i>' : '<i class="fas fa-times" style="color:var(--danger)"></i>';
                            html += `<div>${icon} ${key.replace('_', ' ')}</div>`;
                        }
                        checks.innerHTML = html;
                    }
                }
            } catch (e) {
                console.error(e);
            }
        }

        // --- 2. GENERATOR LOGIC (Frontend JS) ---
        function generatePassword() {
            const length = document.getElementById('lenRange').value;
            const useUpper = document.getElementById('chkUpper').checked;
            const useLower = document.getElementById('chkLower').checked;
            const useNums = document.getElementById('chkNumbers').checked;
            const useSyms = document.getElementById('chkSymbols').checked;

            const charsetUpper = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            const charsetLower = "abcdefghijklmnopqrstuvwxyz";
            const charsetNums = "0123456789";
            const charsetSyms = "!@#$%^&*()_+~`|}{[]:;?><,./-=";

            let finalCharset = "";
            let password = "";

            if(useUpper) finalCharset += charsetUpper;
            if(useLower) finalCharset += charsetLower;
            if(useNums) finalCharset += charsetNums;
            if(useSyms) finalCharset += charsetSyms;

            if(finalCharset === "") {
                alert("Please select at least one character type.");
                return;
            }

            // Ensure at least one of each selected type is included (Security Best Practice)
            if(useUpper) password += charsetUpper.charAt(Math.floor(Math.random() * charsetUpper.length));
            if(useLower) password += charsetLower.charAt(Math.floor(Math.random() * charsetLower.length));
            if(useNums) password += charsetNums.charAt(Math.floor(Math.random() * charsetNums.length));
            if(useSyms) password += charsetSyms.charAt(Math.floor(Math.random() * charsetSyms.length));

            // Fill the rest randomly
            for(let i = password.length; i < length; i++) {
                password += finalCharset.charAt(Math.floor(Math.random() * finalCharset.length));
            }

            // Shuffle the password to mix the forced characters
            password = password.split('').sort(function(){return 0.5-Math.random()}).join('');

            // Display
            document.getElementById('generatedOutput').innerText = password;
            
            // Auto-fill the analyzer (Optional UX improvement)
            document.getElementById('passwordInput').value = password;
        }

        function copyToClipboard() {
            const text = document.getElementById('generatedOutput').innerText;
            if(text === "CLICK GENERATE") return;

            navigator.clipboard.writeText(text).then(() => {
                const tooltip = document.getElementById('copyMsg');
                tooltip.style.display = 'block';
                setTimeout(() => { tooltip.style.display = 'none'; }, 2000);
            });
        }
    </script>
</body>
</html>