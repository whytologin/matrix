<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Deepfake & Synthetic Media Analyzer</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  /* Standard Dark Theme Styles (omitted for brevity) */
  body{font-family:'Poppins',sans-serif;background:#0b0f14;color:#dbe6f2;margin:0;padding:2rem;}
  a{color:#7cc1ff;text-decoration:none}
  .container{max-width:960px;margin:0 auto}
  .card{background:linear-gradient(180deg,#111826,#0b0f14);border:1px solid #1e2a3a;border-radius:14px;padding:1.25rem;box-shadow:0 10px 30px rgba(0,0,0,.4)}
  h1{color:#7cc1ff;margin:.2rem 0 1rem}
  .note{color:#98a8c3;margin-bottom:1rem}
  .field{margin:.75rem 0}
  textarea, input[type="text"] {width:100%;background:#0d1420;color:#e0e0e0;border:1px solid #243247;border-radius:10px;padding:.75rem;font-family: 'Consolas', monospace;}
  .btn{display:inline-block;background:#1a73e8;color:#fff;padding:.65rem 1.1rem;border-radius:10px;border:none;cursor:pointer;font-weight:600}
  .btn:hover{filter:brightness(1.1)}
  pre{background:#071018;color:#b6ffb3;border:1px solid #1c2a3c;border-radius:10px;padding:1rem;overflow:auto;max-height:400px}
  .back{display:inline-block;margin-bottom:1rem}
  .file-input-wrapper {
        border: 2px dashed #243247;
        padding: 20px;
        text-align: center;
        border-radius: 10px;
        background: #0d1420;
    }
    .file-input-wrapper input[type="file"] {
        display: block;
        width: 100%;
        margin-top: 10px;
        padding: 5px;
    }
</style>

</head>
<body>
<div class="container">
<a class="back" href="{{ url_for('dashboard') }}">← Back to Dashboard</a>
<div class="card">
<h1>Deepfake & Synthetic Media Analyzer</h1>
<p class="note">**NEW USP:** Uses Deep Learning (CNN Sim) to detect statistical and temporal anomalies in images and videos, determining if they are real or AI-generated media.</p>

<div class="field file-input-wrapper">
    <label for="fileInput" style="display:block; margin-bottom: 5px; font-weight: 600;">Upload Image or Video File (JPG, PNG, MP4, MOV)</label>
    <input type="file" id="fileInput" accept=".png,.jpg,.jpeg,.gif,.mp4,.mov,.avi">
</div>

<button class="btn" onclick="runAnalysis('deepfake-analyzer')">Analyze for Deepfake Anomalies</button>
<h3>Result</h3>
<pre id="result">—</pre>
</div>
</div>
<script>
async function runAnalysis(route) {
    const fileInput = document.getElementById('fileInput');
    const resultEl = document.getElementById('result');
    
    if (fileInput.files.length === 0) {
        resultEl.textContent = 'Please select an image or video file.';
        return;
    }

    const file = fileInput.files[0];
    const formData = new FormData();
    formData.append('file', file);
    
    const apiUrl = `/api/upload_file/${route}`; // Use the DEDICATED file upload endpoint

    resultEl.innerHTML = '<h4><span style="color: #00aaff;">Uploading, Extracting Features, and Running Deepfake Analysis...</span></h4>';

    try {
        const res = await fetch(apiUrl, {
            method:'POST',
            // IMPORTANT: DO NOT set Content-Type header when sending FormData
            body: formData 
        });
        
        const data = await res.json();
        
        if (data.ok === false) {
             const errorMsg = data.error || data.raw_stderr || 'Unknown execution error.';
             resultEl.innerHTML = `<h4><span style="color: #f44336;">EXECUTION FAILED</span></h4><pre>${errorMsg}</pre>`;
             return;
        }

        const risk = data.risk_level || "Authentic/Real";
        const prediction = data.tool_prediction;
        
        let color = '#4CAF50'; 
        
        if (prediction.includes("Synthetic")) {
            color = '#f44336'; 
        } else if (risk.includes("Suspicious")) {
            color = '#ff9800'; 
        }
        
        resultEl.innerHTML = `
            <h4>Prediction: <span style="color: ${color};">${prediction}</span></h4>
            <p><strong>Risk Level:</strong> ${risk}</p>
            <p><strong>Confidence:</strong> ${(data.confidence_score * 100).toFixed(2)}%</p>
            <p><strong>Main Finding:</strong> ${data.main_finding || 'Analysis completed.'}</p>
            
            <details>
                <summary>Deepfake Analysis Details</summary>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            </details>
        `;
        
    } catch (e) {
        resultEl.innerHTML = `<h4><span style="color: #f44336;">NETWORK/PARSING ERROR</span></h4><pre>${e.message}</pre>`;
    }
}
</script>
</body>
</html>